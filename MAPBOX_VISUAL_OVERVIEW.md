# âœ¨ Mapbox Wizard Implementation - Visual Overview

## ğŸ¬ User Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Opens Circuit Creation Wizard                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Step 1: Perimeter   â”‚
        â”‚ (NEW FEATURE)       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         â”‚
    â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WEB PLATFORM    â”‚  â”‚ MOBILE/NATIVE    â”‚
â”‚ (kIsWeb=true)   â”‚  â”‚ (kIsWeb=false)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”             â”‚
    â”‚            â”‚             â”‚
    â–¼            â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Token Available?  â”‚  â”‚ Grid Painter     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ (CustomPaint)    â”‚
         â”‚             â”‚                  â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”       â”‚  âœ… Fallback    â”‚
    â”‚           â”‚       â”‚  âœ… No token req â”‚
    â–¼           â–¼       â”‚  âœ… Same UX      â”‚
  âœ… YES      âŒ NO     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â”‚           â–¼
    â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      â”‚ Grid Painter     â”‚
    â”‚      â”‚ (Preview Mode)   â”‚
    â”‚      â”‚ - Fallback       â”‚
    â”‚      â”‚ - No token       â”‚
    â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MapboxWebView                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Mapbox GL JS Canvas          â”‚ â”‚
â”‚ â”‚ - Streets Map               â”‚ â”‚
â”‚ â”‚ - Navigation Control        â”‚ â”‚
â”‚ â”‚ - 3D Buildings              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ InkWell Overlay Layer        â”‚ â”‚
â”‚ â”‚ - Capture Taps              â”‚ â”‚
â”‚ â”‚ - Add Points to List        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Overlay Instructions         â”‚ â”‚
â”‚ â”‚ - "Cliquez pour ajouter"    â”‚ â”‚
â”‚ â”‚ - Point Counter             â”‚ â”‚
â”‚ â”‚ - Status: "Mapbox actif"    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€ Tap/Click
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ _addPoint(lat,lng) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ _polygonPoints.add({        â”‚
    â”‚   'lat': lat,              â”‚
    â”‚   'lng': lng               â”‚
    â”‚ })                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ setState()                  â”‚
    â”‚ â”œâ”€ Update Point Counter     â”‚
    â”‚ â”œâ”€ Refresh Preview          â”‚
    â”‚ â””â”€ Show FAB Buttons         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
        â”‚           â”‚
        â–¼           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ UNDO   â”‚  â”‚ CLEAR  â”‚
    â”‚ Button â”‚  â”‚ Button â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚          â”‚
         â–¼          â–¼
   Removelast()  Clear all
         â”‚          â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Validate         â”‚
    â”‚ (â‰¥ 3 points)     â”‚
    â”‚ âœ… Yes â†’ Next     â”‚
    â”‚ âŒ No â†’ Warn      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 2: Tuiles   â”‚
    â”‚ (Offline Mode)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—ï¸ Component Architecture

```
create_circuit_assistant_page.dart
â”‚
â”œâ”€â”€ _StepPerimetre [StatefulWidget]
â”‚   â”‚
â”‚   â”œâ”€â”€ _StepPerimetreState [State]
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ List<Map<String,double>> _polygonPoints
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ _addPoint(lat, lng) â†’ Add to list
â”‚   â”‚   â”œâ”€â”€ _undoLastPoint() â†’ Remove last
â”‚   â”‚   â”œâ”€â”€ _clearPolygon() â†’ Reset all
â”‚   â”‚   â””â”€â”€ _validatePerimeter() â†’ Lock perimeter
â”‚   â”‚
â”‚   â”œâ”€â”€ _buildDrawMode() [Widget]
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Stack[
â”‚   â”‚       â”œâ”€â”€ Container (background)
â”‚   â”‚       â”‚   â””â”€â”€ Stack[
â”‚   â”‚       â”‚       â”œâ”€â”€ MapboxWebView (if web + token)
â”‚   â”‚       â”‚       â”‚   â”œâ”€â”€ HtmlElementView
â”‚   â”‚       â”‚       â”‚   â”œâ”€â”€ Mapbox GL JS
â”‚   â”‚       â”‚       â”‚   â””â”€â”€ Navigation Controls
â”‚   â”‚       â”‚       â”‚
â”‚   â”‚       â”‚       â””â”€â”€ CustomPaint._GridPainter() (fallback)
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ Positioned._InkWell (point capture)
â”‚   â”‚       â”‚   â””â”€â”€ onTap â†’ _addPoint()
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ Positioned.FAB (undo, clear)
â”‚   â”‚
â”‚   â””â”€â”€ _buildPresetMode() [Widget]
â”‚       â””â”€â”€ ListView (zone presets)
â”‚
â””â”€â”€ _MapPreviewWidget [StatelessWidget]
    â”‚
    â”œâ”€â”€ Container (background)
    â””â”€â”€ Stack[
        â”œâ”€â”€ MapboxWebView (if web + token)
        â”œâ”€â”€ CustomPaint._GridPainter() (fallback)
        â”œâ”€â”€ CustomPaint._PolygonPreviewPainter()
        â”œâ”€â”€ CustomPaint._RoutePreviewPainter()
        â”œâ”€â”€ CustomPaint._SegmentsPreviewPainter()
        â”‚
        â”œâ”€â”€ Positioned.Header
        â”‚   â”œâ”€â”€ Title
        â”‚   â””â”€â”€ LIVE Badge
        â”‚
        â””â”€â”€ Positioned.Footer
            â”œâ”€â”€ Info Text
            â””â”€â”€ Mapbox/AperÃ§u Status Badge
```

## ğŸ¨ UI State Transitions

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Draw Mode      â”‚
                    â”‚  0 points       â”‚
                    â”‚  Unvalidated    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                     â”‚
                  â–¼                     â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ 1-2 points   â”‚      â”‚ Clear All    â”‚
            â”‚ Can Undo/    â”‚      â”‚ Back to      â”‚
            â”‚ Clear        â”‚      â”‚ Start        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚           â”‚           â”‚
         â–¼           â–¼           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Add +1 â”‚  â”‚ Undo   â”‚  â”‚ Validate
    â”‚ Point  â”‚  â”‚ Last   â”‚  â”‚ (â‰¥3)
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚          â”‚            â”‚
    [3 points]  [2 pts]    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
         â”‚          â”‚      â”‚ Validate  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â–¶ Dialog    â”‚
                    â”‚      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                    â”‚            â”‚
                    â”‚       â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
                    â”‚       â”‚           â”‚
                    â”‚       â–¼           â–¼
                    â”‚   âœ… Yes      âŒ No
                    â”‚     â”‚           â”‚
                    â”‚     â–¼           â–¼
                    â”‚  Locked     Warn
                    â”‚  Next       (Stay)
                    â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Validated State       â”‚
         â”‚   - Points locked       â”‚
         â”‚   - Perimeter shown     â”‚
         â”‚   - Can proceed         â”‚
         â”‚   - Lock badge shown    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Build Time (--dart-define)                         â”‚
â”‚ MAPBOX_ACCESS_TOKEN = "pk_..."                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Module Load (create_circuit_assistant_page.dart)  â”‚
â”‚ const _mapboxToken = String.fromEnvironment(...)  â”‚
â”‚ const _mapboxToken = "pk_..."  [or ""]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                â”‚
         â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ kIsWeb   â”‚      â”‚ Token    â”‚
    â”‚ = true   â”‚      â”‚ = "pk_"  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ useMapbox = true         â”‚
    â”‚ Render MapboxWebView     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ MapboxWebView      â”‚
    â”‚ â”œâ”€ Token: pk_...   â”‚
    â”‚ â”œâ”€ Style: streets  â”‚
    â”‚ â”œâ”€ Center: 16.2Â°N  â”‚
    â”‚ â””â”€ Zoom: 12.5      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ User Interaction      â”‚
    â”‚ â”‚                     â”‚
    â”‚ â””â”€ Tap on Map         â”‚
    â”‚    â†“                  â”‚
    â”‚    _addPoint()        â”‚
    â”‚    â†“                  â”‚
    â”‚ _polygonPoints â† new  â”‚
    â”‚    â†“                  â”‚
    â”‚ setState()            â”‚
    â”‚    â†“                  â”‚
    â”‚ UI Update             â”‚
    â”‚ â”œâ”€ Counter: "n pts"   â”‚
    â”‚ â”œâ”€ Preview updated    â”‚
    â”‚ â””â”€ FABs visible       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ State Management Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ _StepPerimetreState                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚ Data:                                                   â”‚
â”‚ â”œâ”€ _polygonPoints: []                                  â”‚
â”‚ â”œâ”€ _selectedMode: 'draw' | 'preset'                    â”‚
â”‚ â”œâ”€ _selectedPreset: null | 'id'                        â”‚
â”‚ â””â”€ _isValidated: false | true                          â”‚
â”‚                                                         â”‚
â”‚ Methods:                                                â”‚
â”‚ â”œâ”€ _addPoint(lat, lng)                                 â”‚
â”‚ â”‚  â”œâ”€ Check: !_isValidated âœ…                          â”‚
â”‚ â”‚  â””â”€ Action: _polygonPoints.add(...)                  â”‚
â”‚ â”‚            setState()                                â”‚
â”‚ â”‚                                                      â”‚
â”‚ â”œâ”€ _undoLastPoint()                                    â”‚
â”‚ â”‚  â”œâ”€ Check: !_polygonPoints.isEmpty                  â”‚
â”‚ â”‚  â”œâ”€ Check: !_isValidated                            â”‚
â”‚ â”‚  â””â”€ Action: _polygonPoints.removeLast()             â”‚
â”‚ â”‚            setState()                                â”‚
â”‚ â”‚                                                      â”‚
â”‚ â”œâ”€ _clearPolygon()                                     â”‚
â”‚ â”‚  â”œâ”€ Check: !_isValidated                            â”‚
â”‚ â”‚  â””â”€ Action: _polygonPoints.clear()                  â”‚
â”‚ â”‚            setState()                                â”‚
â”‚ â”‚                                                      â”‚
â”‚ â””â”€ _validatePerimeter()                                â”‚
â”‚    â”œâ”€ Check: _polygonPoints.length â‰¥ 3                â”‚
â”‚    â”œâ”€ Action: _isValidated = true                      â”‚
â”‚    â”‚         setState()                                â”‚
â”‚    â”‚         showSnackBar("âœ“ ValidÃ©")                 â”‚
â”‚    â””â”€ Result: Locked, can proceed                      â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Conditional Rendering Logic

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Build Widget Tree    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚                   â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ kIsWeb?          â”‚  â”‚ kIsWeb?       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   YES              NO
                     â”‚                â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
            â”‚ _mapboxToken      â”‚      â”‚
            â”‚ not empty?        â”‚      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                  â”Œâ”€â”€â”´â”€â”€â”              â”‚
               YES    NO              â”‚
                 â”‚     â”‚              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”‚
         â”‚Mapbox  â”‚ â”‚ Grid    â”‚      â”‚
         â”‚GL JS   â”‚ â”‚ (prev)  â”‚      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                                    â”‚
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚ Grid Painter    â”‚
                           â”‚ (CustomPaint)   â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“± Responsive Layout

```
Desktop (Web)              Mobile (Web)           Native
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MapboxWebView    â”‚  â”‚ MapboxWebViewâ”‚  â”‚ Grid Painter     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚              â”‚ â”‚  â”‚ â”‚          â”‚ â”‚  â”‚ â”‚              â”‚ â”‚
â”‚ â”‚   Mapbox GL  â”‚ â”‚  â”‚ â”‚ Mapbox   â”‚ â”‚  â”‚ â”‚ CustomPaint  â”‚ â”‚
â”‚ â”‚   Streets    â”‚ â”‚  â”‚ â”‚ GL       â”‚ â”‚  â”‚ â”‚ Grid Pattern â”‚ â”‚
â”‚ â”‚              â”‚ â”‚  â”‚ â”‚          â”‚ â”‚  â”‚ â”‚              â”‚ â”‚
â”‚ â”‚ [Nav Ctrl]   â”‚ â”‚  â”‚ â”‚[Nav]     â”‚ â”‚  â”‚ â”‚ [Overlay]    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                  â”‚  â”‚              â”‚  â”‚                  â”‚
â”‚ [Instructions]   â”‚  â”‚[Instructions]â”‚  â”‚ [Instructions]   â”‚
â”‚ [Status Badge]   â”‚  â”‚[Status Badge]â”‚  â”‚ [Status Badge]   â”‚
â”‚ [FABs]           â”‚  â”‚[FABs]        â”‚  â”‚ [FABs]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    Full Mapbox         Full Mapbox        Grid Fallback
    1920Ã—1080          375Ã—812            Multiple sizes
```

## âœ… Feature Checklist

```
Implementation
â”œâ”€ [âœ…] Token Integration
â”œâ”€ [âœ…] Mapbox Rendering (web)
â”œâ”€ [âœ…] Grid Fallback
â”œâ”€ [âœ…] Point Capture
â”œâ”€ [âœ…] Undo/Clear
â”œâ”€ [âœ…] Validation
â”œâ”€ [âœ…] State Management
â”œâ”€ [âœ…] Error Handling (missing token)
â””â”€ [âœ…] UI Polish

Documentation
â”œâ”€ [âœ…] Feature Overview
â”œâ”€ [âœ…] Integration Status
â”œâ”€ [âœ…] Deployment Guide
â”œâ”€ [âœ…] Technical Details
â”œâ”€ [âœ…] Commit Guide
â””â”€ [âœ…] Documentation Index

Testing (TODO)
â”œâ”€ [ ] Code compiles
â”œâ”€ [ ] Tokens work
â”œâ”€ [ ] Fallback works
â”œâ”€ [ ] Points capture
â”œâ”€ [ ] Undo works
â”œâ”€ [ ] Validation works
â”œâ”€ [ ] Browser test
â””â”€ [ ] Performance check
```

---

**Version**: 1.0  
**Date**: 2025-01-24  
**Status**: Ready for Testing ğŸŸ¢
